---
- name: Block HTTP/HTTPS traffic to 10.0.8.0/24
  hosts: 10.0.2.20
  remote_user: vagrant
  become: true
  vars:
    ansible_become_pass: "vagrant"

  tasks:
    - name: Block incoming HTTP traffic to 10.0.8.0/24
      iptables:
        chain: OUTPUT
        protocol: tcp
        destination_port: "80"
        destination: 10.0.8.0/24
        jump: DROP
        state: present

    - name: Block incoming HTTPS traffic to 10.0.8.0/24
      iptables:
        chain: OUTPUT
        protocol: tcp
        destination_port: "443"
        destination: 10.0.8.0/24
        jump: DROP
        state: present

    - name: Save iptables rules (if applicable - RedHat)
      shell: /sbin/iptables-save > /etc/sysconfig/iptables
      when: ansible_os_family == "RedHat"
      become: true

    - name: Save iptables rules (if applicable - Debian/Ubuntu)
      shell: /sbin/iptables-save > /etc/iptables/rules.v4
      when: ansible_os_family == "Debian"
      become: true
